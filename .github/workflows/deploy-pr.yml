# ==============================================================================
# PR Deployment Workflow
# ==============================================================================
# This workflow handles deployments triggered by pull requests and manual
# selections via the GitHub Actions UI.
# ==============================================================================

name: Deploy PR to Environment

on:
  # Automatic trigger on PR events
  pull_request:
    types: [opened, synchronize, reopened]

  # Manual trigger via GitHub UI - deploys directly to test3 with values from current branch
  workflow_dispatch:

jobs:
  deploy-test1:
    if: github.event_name == 'pull_request'
    name: Deploy to Test1
    uses: ./.github/workflows/deploy-theia.yml
    with:
      environment: test1
      theia_cloud_tag: 'latest'
      ide_images_tag: 'latest'
      helm_chart_branch: ''
    secrets: inherit

  deploy-test2:
    if: github.event_name == 'pull_request'
    name: Deploy to Test2
    uses: ./.github/workflows/deploy-theia.yml
    with:
      environment: test2
      theia_cloud_tag: 'latest'
      ide_images_tag: 'latest'
      helm_chart_branch: ''
    secrets: inherit

  deploy-test3:
    if: github.event_name == 'pull_request' || github.event_name == 'workflow_dispatch'
    name: Deploy to Test3
    uses: ./.github/workflows/deploy-theia.yml
    with:
      environment: test3
      theia_cloud_tag: 'use-values-file'
      ide_images_tag: 'use-values-file'
      helm_chart_branch: ''
    secrets: inherit